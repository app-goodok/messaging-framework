image: registry.gitlab.com/goodok-chat/messaging-framework:latest
variables:
  DEBIAN_FRONTEND: noninteractive
stages:
  - build
  - test
  - package
cache:
  paths:
    - /root/.conan/
Build:
  stage: build
  before_script:
    - mkdir build && cd build && mkdir -p proto
    - conan profile new goodok-profile --detect
    - conan profile update settings.compiler.version=9.3 goodok-profile
    - conan profile update settings.compiler.libcxx=libstdc++11 goodok-profile
    - conan install -s build_type=Release .. --build=missing --profile goodok-profile
    - cd ..
  script:
    - cd build
    - cmake ..
    - cmake --build . -- -j 4
  artifacts:
    paths:
      - build/
#    - cmake --build . --target test
#    - cmake --build . --target package

Test:
  stage: test
  script:
    - cmake --build . --target test
    - cmake --build . --target package
  dependencies:
    - build
    - cmake --build . --target test
  artifacts:
    paths:
      - build/Messaging-framework-*.deb